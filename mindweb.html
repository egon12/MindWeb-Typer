<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>MindWeb</title>
    <style>
        body {
            font-family : 'Cantarell', 'Helvetica', 'Sans-serif';
            margin : 0;
            padding : 0;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family : 'Aileron UltraLight';
        }

        fieldset {
            margin : 0;
            padding : 0;
        }

        textarea {
            border-radius : 0;
            border : 1px solid gray;
        }

        #input-content {
            width : 300px;
            height : 300px;
            /*opacity : 0.1;*/
            position : fixed;
            bottom : 150px;
            right : 0;
        }

        #input-type {
            width : 300px;
            height : 26px;
            position : fixed;
            bottom : 123px;
            right : 0;
        }

        #input-config {
            width : 300px;
            height : 150px;
            /*opacity : 0.1; */
            position : fixed;
            bottom : 451px;
            right : 0;
        }

        #input-md {
            width : 300px;
            height : 100px;
            /*opacity : 0.1;*/
            position : fixed;
            bottom : 0;
            right : 0;
        }

        #input-config:focus, #input-content:focus, #input-type:focus, #input-md:focus {
            opacity : 0.5;
        }

        #input-config:hover, #input-content:hover, #input-type:focus, #input-md:hover {
            opacity : 0.8 !important;
        }

        #vis, #text {
            position : absolute;
            top : 0;
            left : 0;
        }


    </style>
</head>
<body id="Hallo" onload="">
    <textarea id="input-config"></textarea>
    <textarea id="input-content"></textarea>
    <fieldset id="input-type">
        <label>Free      <input type="radio" name="input-type" value="free" selected="selected"></label>
        <label>Raw       <input type="radio" name="input-type" value="raw"></label>
        <label>Json Tree <input type="radio" name="input-type" value="jsontree"></label>
        <label>Flow      <input type="radio" name="input-type" value="flow"></label>
    </fieldset>
    <textarea id="input-md"></textarea>
    <div id="vis"></div>
    <div id="text"></div>
    
    <script src="./lib/d3/d3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="./lib/markdown/markdown.js"></script>
    <script src="./lib/jquery/jquery.min.js"></script>
    <script src="./src/validator.js"></script>
    <script src="./src/textProcessor.js" type="text/javascript" charset="utf-8"></script>
    <script src="./src/treeProcessor.js" type="text/javascript" charset="utf-8"></script>
    <script src="./src/painter.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var painter = new MindWebPainter('#vis');
        var inputContent = document.getElementById('input-content');
        var inputConfig = document.getElementById('input-config');
        var inputMd = document.getElementById('input-md');
        var mdText = document.getElementById('text');

        function processInput() {
            var type = $('input[name="input-type"]:checked').val();
            var content = '';
            switch (type) {
                case 'free':
                    content = textProcessor(inputContent.value);
                    break;
                case 'raw':
                    content = JSON.parse(inputContent.value);
                    break;
                case 'jsontree':
                    console.log(inputContent.value);
                    content = treeProcessor(JSON.parse(inputContent.value));
                    break;
            }
            inputMd.value = JSON.stringify(content, undefined, 2);
            painter.draw(content);
        };

        inputContent.onkeydown = function(e) {
            if (e.keyCode == 13) {
                processInput();
            }
        };

        inputContent.onchange = processInput;

        inputConfig.onchange = function(e) {
            painter.setConfig(JSON.parse(e.currentTarget.value));
            painter.init('#vis');
            processInput();
        };

        /*
        inputMd.oninput = function(e) {
            mdText.innerHTML = markdown.toHTML(e.currentTarget.value)
        }
        */

        if (inputConfig.value === '') {
            inputConfig.value = JSON.stringify(painter.getConfig(), undefined, 2);
        }

    </script>
</body>
</html>
